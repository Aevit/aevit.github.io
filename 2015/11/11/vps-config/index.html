<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="VPS配置"/>




  <meta name="keywords" content="比特海, 后台, VPS, Aevit" />










  <link rel="alternate" href="/atom.xml" title="Aevit">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.5.0" />



<link rel="canonical" href="http://aevit.xyz/2015/11/11/vps-config/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.5.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?27c09d216f39fb173da80070c4219fb8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> VPS配置 - Aevit </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Aevit</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Aevit</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          VPS配置
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2015-11-11
        </span>
        
          <div class="post-category">
            
              <a href="/categories/比特海/">比特海</a>
            
          </div>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#硬件配置"><span class="toc-text">硬件配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh端口"><span class="toc-text">ssh端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#梯子"><span class="toc-text">梯子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端安装"><span class="toc-text">服务端安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#客户端配置"><span class="toc-text">客户端配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局科学上网"><span class="toc-text">全局科学上网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化加速"><span class="toc-text">优化加速</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#锐速"><span class="toc-text">锐速</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gevent"><span class="toc-text">gevent</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP环境配置"><span class="toc-text">LNMP环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shadowsocks一键安装脚本"><span class="toc-text">shadowsocks一键安装脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#性能测试"><span class="toc-text">性能测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#信息查看"><span class="toc-text">信息查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#硬盘IO性能测试"><span class="toc-text">硬盘IO性能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VPS网络性能测试"><span class="toc-text">VPS网络性能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VPS-PING值测试"><span class="toc-text">VPS PING值测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VPS探针测试"><span class="toc-text">VPS探针测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UnixBench跑分"><span class="toc-text">UnixBench跑分</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p>去西藏前，想着如果能安全回来就租个VPS玩玩<br>于是11.1那天看了下 <a href="https://www.linode.com" target="_blank" rel="external">linode</a> 的东京机房，可惜已经没货了，刷了一天都没有<br>最后在11.2租了 <a href="https://www.conoha.jp/" target="_blank" rel="external">conaha</a> 的东京机房<br>虽然速度没有<code>linode</code>的快，不过只能先顶着用了</p>
<p>本文主要记录了<code>shadowsocks</code>配置、<code>LNMP</code>环境配置、<code>VPS</code>性能测试</p>
<a id="more"></a>
<p>内容有点多，可以在PC端点击<code>右下角</code>那个<code>汉堡图标</code>按钮展开目录</p>
<h2 id="硬件配置"><a href="#硬件配置" class="headerlink" title="硬件配置"></a>硬件配置</h2><p>配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">东京VPS</div><div class="line">CPU: 2Core</div><div class="line">内存: 1GB</div><div class="line">SSD: 50G</div><div class="line">系统: CentOS 7.1 64bit  </div><div class="line">价格(感人): 900日元/per month (40多RMB)</div><div class="line">支付方式(感人): 支持支付宝</div></pre></td></tr></table></figure>
<p>附1-1:<br><a href="https://www.linode.com/pricing" target="_blank" rel="external">linode配置与价格</a><br><a href="https://www.conoha.jp/zh/pricing" target="_blank" rel="external">conaha配置与价格</a></p>
<blockquote>
<p><a href="https://www.conoha.jp/referral/?token=TlQVI4AgGwmnLSwbdtwa_wN5HuMzWSXMtUBP2i3952hmu.WL.d0-G9Y" target="_blank" rel="external">注册地址</a><br>通过上面的邀请链接注册账户，新注册账户充值一定日元(以前是500元，大约25元RMB左右，现在不清楚了)，我和你都将会得到一定的赠送（以前是送1000日元，现在不知道了）</p>
</blockquote>
<h2 id="ssh端口"><a href="#ssh端口" class="headerlink" title="ssh端口"></a>ssh端口</h2><p>为了安全起见，先更改ssh的默认端口（默认为22）；端口不超过65535，并且1024及以下的为系统端口，也不要使用。<br>这里以更改为<code>11223</code>为例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<p>将里面的<code>Port</code>修改为如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Port 22</div><div class="line">Port 11223</div><div class="line"></div><div class="line"># 注: 这里先保留22端口，是为了防止后面有其他情况使得 11223 端口还不可以使用</div><div class="line"># 如防火墙里没有添加 11223 端口，这时把 22 端口取消，那就悲剧了...</div></pre></td></tr></table></figure>
<p>重启sshd（注意不同系统版本的命令可能会稍有不同，这里以我测试过的两台不同系统的服务器为例）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># CentOS 6</div><div class="line">service sshd restart</div><div class="line"></div><div class="line"># CentOS 7</div><div class="line">/bin/systemctl restart sshd.service</div></pre></td></tr></table></figure>
<p>如果有开启了防火墙，还需要添加<code>11223</code>端口:</p>
<blockquote>
<p>由于习惯问题，我在<code>CentOS 7</code>下，将默认的<code>FireWallD</code>防火墙，更改为<code>iptables</code>了，所以下面在<code>CentOS 7</code>下的防火墙相关命令是用<code>iptables</code>相关的，请注意</p>
</blockquote>
<p>查看防火墙是否有启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># CentOS 6</div><div class="line">service iptables status</div><div class="line"></div><div class="line"># CentOS 7</div><div class="line">/bin/systemctl status  iptables.service</div></pre></td></tr></table></figure>
<blockquote>
<p>如果防火墙没有启动，请直接去将上面的<code>22</code>端口注释掉，再重启<code>sshd</code>即可，后面的操作不用了。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/iptables</div></pre></td></tr></table></figure>
<p>添加端口:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 11223 -j ACCEPT</div></pre></td></tr></table></figure>
<p>重启防火墙（注意不同系统版本的命令可能会稍有不同，这里以我测试过的两台不同系统的服务器为例）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># CentOS 6</div><div class="line">service iptables restart</div><div class="line"></div><div class="line"># CentOS 7</div><div class="line">/bin/systemctl restart iptables.service</div></pre></td></tr></table></figure>
<p>接下来进行测试，看能不能使用<code>11223</code>端口进行ssh登录，如果可以了，<strong>记得</strong>回去将上面的<code>Port 22</code>端口去掉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim /etc/ssh/sshd_config</div><div class="line"></div><div class="line"># 修改配置内容</div><div class="line">#Port 22</div><div class="line">Port 11223</div><div class="line"></div><div class="line"># 重启ssh# </div><div class="line"># CentOS 6</div><div class="line">service sshd restart</div><div class="line"># CentOS 7</div><div class="line">/bin/systemctl restart sshd.service</div></pre></td></tr></table></figure>
<h2 id="梯子"><a href="#梯子" class="headerlink" title="梯子"></a>梯子</h2><p>面对国内日益严峻的高墙形势，身为一条程序狗，需要有一门轻巧方便的穿墙术。<br>以前都是租第三方的梯子用，所以VPS启动后的第一件事是搭自己的梯子。<br>这次使用的是开源的<code>shadowsocks</code>来配置（虽然8月份时该作者被请喝茶，删了全部源代码，不过还是要感谢作者<a href="https://twitter.com/clowwindy" target="_blank" rel="external">@clowwindy</a>）。</p>
<p>以下操作都是基于系统<code>CentOS 7.1 64bit</code></p>
<h3 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">#更新yum源</div><div class="line">yum update  </div><div class="line"></div><div class="line">#确保python版本 ≥ 2.6</div><div class="line">python --version</div><div class="line"></div><div class="line">#版本没问题后，使用pip安装即可  </div><div class="line">yum install python-setuptools &amp;&amp; easy_install pip</div><div class="line">pip install shadowsocks  </div><div class="line"></div><div class="line">vim /etc/shadowsocks.json  </div><div class="line">#粘贴以下内容保存：  </div><div class="line">&#123;</div><div class="line">    &quot;server&quot;:&quot;your_server_ip&quot;,</div><div class="line">    &quot;local_address&quot;:&quot;127.0.0.1&quot;,</div><div class="line">    &quot;local_port&quot;:1080,</div><div class="line">    &quot;port_password&quot;:&#123;</div><div class="line">        &quot;your_port_1&quot;:&quot;your_pw_1&quot;,</div><div class="line">        &quot;your_port_2&quot;:&quot;your_pw_2&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;timeout&quot;:600,</div><div class="line">    &quot;method&quot;:&quot;aes-256-cfb&quot;,  </div><div class="line">    &quot;fast_open&quot;:false,</div><div class="line">    &quot;workers&quot;:1</div><div class="line">&#125;</div><div class="line"></div><div class="line">#以上各字段说明见下面&quot;附2-1-1&quot;</div><div class="line"></div><div class="line">#使用该配置文件在后台运行即可：  </div><div class="line">ssserver -c /etc/shadowsocks.json -d start   </div><div class="line"></div><div class="line">#停止运行：将上面的`start`改为`stop`即可</div></pre></td></tr></table></figure>
<p>注: 如果系统开启了防火墙，还需要添加规则让上面设置的端口生效<br>由于<code>CentOS 7.1</code>的防火墙默认是用<code>firewalld</code>代替了<code>iptables</code><br>所以使用以下命令设置规则（注意将<code>your_port_1</code> <code>your_port_2</code>修改为自己的端口）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --add-port=your_port_1/tcp</div><div class="line">firewall-cmd --permanent --add-port=your_port_2/tcp</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure>
<p>如果在<code>CentOS 7.1</code>下，还是使用<code>iptables</code>，则修改<code>/etc/sysconfig/iptables</code>文件去添加以下规则（注意将<code>your_port_1</code> <code>your_port_2</code>修改为自己的端口）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/iptables  </div><div class="line"></div><div class="line"># 编辑内容，添加以下两句  </div><div class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport your_port_1 -j ACCEPT</div><div class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport your_port_2 -j ACCEPT</div><div class="line"></div><div class="line"># 保存并退出后，再使用以下命令重启iptables  </div><div class="line">/bin/systemctl restart iptables.service</div></pre></td></tr></table></figure>
<p>再注: 如果不喜欢上面的方法，可使用网上众大神提供的一键安装脚本<br>a. <a href="https://teddysun.com/342.html" target="_blank" rel="external">teddysun的脚本</a><br>b. <a href="https://blog.linuxeye.com/423.html" target="_blank" rel="external">linuxeye的脚本</a> —— 此脚本已集成到<code>oneinstack</code>（见下面<code>3-2</code>说明）</p>
<h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><p>windows及mac都有图形化的客户端，以下为mac的界面，设置好即可进行科学上网</p>
<p><img src="http://aevit.qiniudn.com/shadowsocks-mac-config.png" alt="image"></p>
<h3 id="全局科学上网"><a href="#全局科学上网" class="headerlink" title="全局科学上网"></a>全局科学上网</h3><p>只使用<code>shadowsocks</code>的话，只能让浏览器科学上网，如果需要 全部或部分 软件也能科学上网，可以搭配<a href="http://www.proxifier.com/" target="_blank" rel="external">Proxifier</a> 这个东西。这是个收费软件，使用起来挺简单的，这里不再赘述。</p>
<h3 id="优化加速"><a href="#优化加速" class="headerlink" title="优化加速"></a>优化加速</h3><h4 id="锐速"><a href="#锐速" class="headerlink" title="锐速"></a>锐速</h4><p>推荐使用<a href="http://www.serverspeeder.com/" target="_blank" rel="external">锐速</a><br>锐速是一款专业的TCP加速引擎，一种只需单边部署就可以起到显著加速效果的TCP加速技术</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://my.serverspeeder.com/d/ls/serverSpeederInstaller.tar.gz</div><div class="line">tar xzvf serverSpeederInstaller.tar.gz</div><div class="line">bash serverSpeederInstaller.sh</div></pre></td></tr></table></figure>
<p>之后输入锐速的账号密码，再一步一步按enter下去即可</p>
<p>下面是关于锐速配置的一些优化说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#设置：advinacc=&quot;1&quot;,maxmode=&quot;1&quot;，rsc=&quot;1&quot; 保存退出</div><div class="line">vim /serverspeeder/etc/config</div><div class="line"></div><div class="line">#重启锐速</div><div class="line">/serverspeeder/bin/serverSpeeder.sh restart</div><div class="line"></div><div class="line">#打开配置文件，加入以下两行</div><div class="line">vim /etc/security/limits.conf</div><div class="line"></div><div class="line">* soft nofile 51200</div><div class="line">* hard nofile 51200</div><div class="line"></div><div class="line">#修改linux最大文件限制数ulimit</div><div class="line">ulimit -n 51200</div><div class="line"></div><div class="line">#后台重新启动shadowsocks服务</div><div class="line">ssserver -c /etc/shadowsocks.json -d restart</div></pre></td></tr></table></figure>
<p>如果启动报错，那么<code>vim``以上config文件</code>里的<code>gso=1</code>即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Actual changes:</div><div class="line">scatter-gather: off</div><div class="line"> tx-scatter-gather: off</div><div class="line"> tx-scatter-gather-fraglist: off</div><div class="line">udp-fragmentation-offload: off [requested on]</div></pre></td></tr></table></figure>
<p>锐速操作命令说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#启动  </div><div class="line">/serverspeeder/bin/serverSpeeder.sh start</div><div class="line"></div><div class="line">#停止  </div><div class="line">/serverspeeder/bin/serverSpeeder.sh stop</div><div class="line"></div><div class="line">#卸载，需先cd到sh脚本路径  </div><div class="line">./serverSpeederInstaller.sh uninstall</div></pre></td></tr></table></figure>
<h4 id="gevent"><a href="#gevent" class="headerlink" title="gevent"></a>gevent</h4><p>安装<code>gevent</code>以提高Shadowsocks-Python的性能，<code>gevent</code>是基于协程的Python网络库，可以提高Python的I/O性能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install python-devel</div><div class="line">pip install greenlet</div><div class="line">pip install gevent</div></pre></td></tr></table></figure>
<hr>
<p><code>附2-1-1</code>: 各字段的含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1. server：服务器 IP (IPv4/IPv6)（VPS本身可填：0.0.0.0）  </div><div class="line">2. local_address：本地监听的 IP 地址（如：127.0.0.1）</div><div class="line">3. local_port：本地端端口（建议：1080）</div><div class="line">4. port_password：监听的服务器端口:密码</div><div class="line">5. timeout：超时时间（秒）</div><div class="line">6. method：加密方法，可选择&quot;bf-cfb&quot;, &quot;aes-256-cfb&quot;, &quot;des-cfb&quot;, &quot;rc4&quot;, 等等。</div><div class="line">默认是一种不安全的加密，推荐用&quot;aes-256-cfb&quot;  </div><div class="line">7. works：works数量，默认为 1  </div><div class="line">8. fast_open：true 或 false。如果你的服务器 Linux 内核在3.7+，可以开启 fast_open 以降低延迟。  </div><div class="line">开启方法：echo 3 &gt; /proc/sys/net/ipv4/tcp_fastopen</div><div class="line">开启之后，将 fast_open 的配置设置为 true 即可。</div></pre></td></tr></table></figure>
<p><code>附2-1-2</code>：开启<code>firewalld</code>，关闭<code>iptables</code>的方法说明（<a href="http://silverchard.me/t0006.html#11" target="_blank" rel="external">来源</a>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#查看firewalld（masked为关闭），iptables（enabled为开启）开关状态  </div><div class="line">systemctl list-unit-files|grep &apos;firewall\|iptables&apos;</div><div class="line"></div><div class="line">systemctl start firewalld.service #开启firewalld</div><div class="line">systemctl enable firewalld.service #永久开启firewalld</div><div class="line"></div><div class="line">#关闭iptables</div><div class="line">systemctl stop iptables.service #关闭iptables</div><div class="line">systemctl stop ip6tables.service #关闭iptables ipv6</div><div class="line">systemctl disable iptables.service #停用iptables</div><div class="line">systemctl disable ip6tables.service #停用iptables ipv6</div><div class="line">systemctl mask iptables.service #mask掉iptables 可以理解为停用彻底关闭</div><div class="line">systemctl mask ip6tables.service #mask掉ipv6 iptables 同上</div><div class="line"></div><div class="line">firewall-cmd --state #再次检查firewalld是否开启</div></pre></td></tr></table></figure>
<hr>
<h2 id="LNMP环境配置"><a href="#LNMP环境配置" class="headerlink" title="LNMP环境配置"></a>LNMP环境配置</h2><p>租VPS的主要目的还是想瞎搞点东西，写写接口给自己的iOS端（或前端）使用<br>使用的环境是<code>LNMP</code>（Linux+Nginx+Mysql+PHP）</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>以前已经给公司的服务器手动配置过环境，觉得略微繁琐，不想在自己的VPS上花太多时间在配置上面，所以这次使用的是一键安装包<a href="http://oneinstack.com/" target="_blank" rel="external">oneinstack</a></p>
<p>安装方法见<a href="http://oneinstack.com/install/" target="_blank" rel="external">官网说明</a>即可</p>
<h3 id="shadowsocks一键安装脚本"><a href="#shadowsocks一键安装脚本" class="headerlink" title="shadowsocks一键安装脚本"></a>shadowsocks一键安装脚本</h3><p>无意中发现了<code>oneinstack</code>竟然有<code>shadowsocks</code>的一键安装脚本（感人），个人觉得是比较方便的一个脚本，现记录下安装方法（<a href="https://blog.linuxeye.com/423.html" target="_blank" rel="external">来源</a>）</p>
<p>2015.7.8 <strong>前</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cd oneinstack</div><div class="line"></div><div class="line">wget http://mirrors.linuxeye.com/lnmp/shadowsocks.sh</div><div class="line"></div><div class="line">chmod +x shadowsocks.sh</div><div class="line"></div><div class="line">#安装、添加用户、卸载和后面一样</div><div class="line">./shadowsocks.sh install</div></pre></td></tr></table></figure>
<p>2015.7.8 <strong>后</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#使用wget，或本机下载好再传过去  </div><div class="line">wget http://mirrors.linuxeye.com/oneinstack.tar.gz</div><div class="line"></div><div class="line">tar xzf oneinstack.tar.gz</div><div class="line"></div><div class="line">cd oneinstack</div><div class="line"></div><div class="line">./shadowsocks.sh install</div></pre></td></tr></table></figure>
<p>出现如下即安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Your Server IP: You_Server_IP</div><div class="line">Your Server Port: 9001</div><div class="line">Your Password: oneinstack</div><div class="line">Your Local IP: 127.0.0.1</div><div class="line">Your Local Port: 1080</div><div class="line">Your Encryption Method: aes-256-cfb</div></pre></td></tr></table></figure>
<p>Shadowsocks添加用户（感人的方便）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./shadowsocks.sh adduser</div></pre></td></tr></table></figure>
<p>Shadowsocks服务管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">service shadowsocks start     #启动</div><div class="line">service shadowsocks stop      #关闭</div><div class="line">service shadowsocks restart   #重启</div><div class="line">service shadowsocks status    #状态</div></pre></td></tr></table></figure>
<hr>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>主要是测试VPS的CPU、硬盘IO、网络性能、跑分等</p>
<p>以下测试内容参考自：<br><a href="http://www.imeoe.com/219.html" target="_blank" rel="external">Linux VPS性能测试方法</a><br><a href="http://www.linode.im/1667.html" target="_blank" rel="external">8步测评hardbirch的xen 512 Linux VPS</a></p>
<h3 id="信息查看"><a href="#信息查看" class="headerlink" title="信息查看"></a>信息查看</h3><p>4-1-1 查看cpu相关信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/cpuinfo</div></pre></td></tr></table></figure>
<p>4-1-2 资源消耗查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top</div></pre></td></tr></table></figure>
<p>4-1-3 内存使用情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">free -m</div></pre></td></tr></table></figure>
<p>4-1-4 linux版本查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /etc/issue</div></pre></td></tr></table></figure>
<p>更多相关信息查看可以查阅：<br><a href="http://www.imeoe.com/217.html" target="_blank" rel="external">linux下查看系统配置常用命令</a></p>
<h3 id="硬盘IO性能测试"><a href="#硬盘IO性能测试" class="headerlink" title="硬盘IO性能测试"></a>硬盘IO性能测试</h3><p>测试硬盘IO性能，对硬盘的损害很大，不建议多次或长时间尝试，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/zero of=test bs=64k count=4k oflag=dsync</div></pre></td></tr></table></figure>
<p>这个值越大越好，如果超过10M，对正常建站就无影响。超过50M，就是非常给力状态。</p>
<h3 id="VPS网络性能测试"><a href="#VPS网络性能测试" class="headerlink" title="VPS网络性能测试"></a>VPS网络性能测试</h3><p>VPS的网络性能，主要分出口（上行速度）和入口（下行速度）二个指标，入口可以用wget文件得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://cachefly.cachefly.net/100mb.test</div></pre></td></tr></table></figure>
<p>看下载速度，如果是11M/s，大概就是百兆口。70M/S，大概就是G口。VPS搭建好网站环境后，可以用其它的VPS去拽这个文件，得到出口的带宽。</p>
<p><strong>下载完后，记得删除该文件</strong></p>
<h3 id="VPS-PING值测试"><a href="#VPS-PING值测试" class="headerlink" title="VPS PING值测试"></a>VPS PING值测试</h3><p>主要测试是PING值，和观看TRACERT值，来判断速度。可用以下几个网站：</p>
<p>站长网：<a href="http://ping.chinaz.com" target="_blank" rel="external">超级ping工具</a> – <a href="http://tool.chinaz.com/Tracert/" target="_blank" rel="external">路由追踪工具</a><br>卡卡网：<a href="www.webkaka.com/ping.aspx">ping工具</a> – <a href="www.webkaka.com/Tracert.aspx">tracert工具</a><br>国外的：<a href="www.just-ping.com">www.just-ping.com</a><br>软件：<a href="http://www.speedtest.net/mini.php" target="_blank" rel="external">http://www.speedtest.net/mini.php</a><br>国内的：<a href="http://www.17ce.com/" target="_blank" rel="external">http://www.17ce.com/</a></p>
<h3 id="VPS探针测试"><a href="#VPS探针测试" class="headerlink" title="VPS探针测试"></a>VPS探针测试</h3><p>当然还有最简单的方法，在搭建好web环境后，可以使用探针测试。<br>如果支持php的话，可以使用<a href="http://www.yahei.net/" target="_blank" rel="external">雅黑php探针</a></p>
<h3 id="UnixBench跑分"><a href="#UnixBench跑分" class="headerlink" title="UnixBench跑分"></a>UnixBench跑分</h3><p>一款国外提供的linux性能专用软件，可以跑出分数来让你做对比</p>
<p>以下是 <a href="https://teddysun.com/245.html" target="_blank" rel="external">秋水逸冰的一键安装脚本</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget https://teddysun.com/wp-content/uploads/unixbench.sh</div><div class="line">chmod +x unixbench.sh</div><div class="line">./unixbench.sh</div></pre></td></tr></table></figure>
<p>总分情况，低于400的就算性能低下；600-800是属于正常VPS水准；超过1000分性能就算给力 （PS：看的是12年的一篇文章，不知道现在的标准是多少）</p>
<hr>
<p>2015.11.11 01:53<br>Aevit<br>华师</p>
<p><a href="http://aevit.qiniudn.com/moon-from-650d.jpg" title="楼顶月" target="_blank" rel="external"><img src="http://aevit.qiniudn.com/moon-from-650d.jpg" alt=""></a></p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/比特海/">比特海</a>
            
              <a href="/tags/后台/">后台</a>
            
              <a href="/tags/VPS/">VPS</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2015/11/11/vps-config-git/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">VPS配置 - Git</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2015/11/09/table-to-json/">
        <span class="next-text nav-default">Table数据转JSON</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:aevit@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/aevit" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2014 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Aevit</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://aevit.xyz/2015/11/11/vps-config/';
        this.page.identifier = '2015/11/11/vps-config/';
        this.page.title = 'VPS配置';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//aevit.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.5.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.5.0"></script>

  </body>
</html>
