<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Laravel学习笔记（二）- 登录授权流程分析"/>




  <meta name="keywords" content="比特海, PHP, Laravel, 登录授权, Aevit" />










  <link rel="alternate" href="/atom.xml" title="Aevit">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.5.0" />



<link rel="canonical" href="http://aevit.xyz/2016/05/11/laravel-learning-2/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.5.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?27c09d216f39fb173da80070c4219fb8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



    <title> Laravel学习笔记（二）- 登录授权流程分析 - Aevit </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Aevit</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            About
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Aevit</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Laravel学习笔记（二）- 登录授权流程分析
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-05-11
        </span>
        
          <div class="post-category">
            
              <a href="/categories/比特海/">比特海</a>
            
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#artisan命令"><span class="toc-text">artisan命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库相关"><span class="toc-text">数据库相关</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解析"><span class="toc-text">解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#auth流程分析"><span class="toc-text">auth流程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#新文件说明"><span class="toc-text">新文件说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路由"><span class="toc-text">路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HomeController"><span class="toc-text">HomeController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blade模版文件"><span class="toc-text">blade模版文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自定义"><span class="toc-text">自定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#修改auth前缀"><span class="toc-text">修改auth前缀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转移blade文件路径"><span class="toc-text">转移blade文件路径</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><code>Laravel</code> 内置了登录授权相关的一些东西，可以开箱即用。<br>接下来将会对登录授权的使用方法及流程分析进行一下介绍。<br>通过这篇文章，可以了解以下东西：</p>
<ol>
<li>学会使用<code>laravel</code>的自带登录授权功能；</li>
<li>了解自带的登录授权的相关流程；</li>
<li>修改自带的<code>auth</code>相关路由前缀；</li>
<li>更改<code>auth</code>的<code>blade</code>模版文件路径</li>
</ol>
<a id="more"></a>
<blockquote>
<p>注意：使用的框架版本是 <code>5.2</code>，跟旧版本会有一点出入，后面会提到</p>
</blockquote>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="artisan命令"><a href="#artisan命令" class="headerlink" title="artisan命令"></a>artisan命令</h2><p>首先在项目根目录执行一条<code>artisan</code>命令，即可自动安装一个简易的完整的用户认证系统。</p>
<blockquote>
<p>注意该命令会产生一些文件，如 <code>HomeController.php</code> ，如果你的项目已存在 相同路径相同命名 的文件，请先备份一下<br>具体会产生什么文件，请看下面说明</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan make:auth</div></pre></td></tr></table></figure>
<p>让我们看下执行这条命令后会有什么变动：</p>
<p>1、会修改 ./app/Http/routes.php 路由文件，增加以下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([&apos;middleware&apos; =&gt; &apos;web&apos;], function () &#123;</div><div class="line">    Route::auth();</div><div class="line"></div><div class="line">    Route::get(&apos;/home&apos;, &apos;HomeController@index&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>2、会增加文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 1、在 ./resources/views/ 目录生成以下`blade`模版文件    </div><div class="line">home.blade.php</div><div class="line">welcome.blade.php  </div><div class="line"></div><div class="line">layouts/app.blade.php</div><div class="line"></div><div class="line">auth/login.blade.php  </div><div class="line">auth/register.blade.php</div><div class="line">auth/emails/password.blade.php</div><div class="line">auth/passwords/email.blade.php</div><div class="line">auth/passwords/reset.blade.php</div><div class="line"></div><div class="line">// 2、在 ./app/Http/Controllers 目录下生成以下文件  </div><div class="line">HomeController.php</div></pre></td></tr></table></figure>
<p>现在只要访问<code>www.your-domain.com/home</code>，就会自动判断如果没有登录，就自动跳转至登录页面<code>www.your-domain.com/login</code>页面了。<br>接下来只要再配置好数据库相关部分，就基本完成了登录注册模块的功能了。</p>
<h2 id="数据库相关"><a href="#数据库相关" class="headerlink" title="数据库相关"></a>数据库相关</h2><p><code>Laravel</code>数据库简单介绍可以查看这篇文章：<a href="http://www.jianshu.com/p/45f6dbf4e536" target="_blank" rel="external">数据库配置与使用migations生成表</a></p>
<p>数据库的配置文件位于<code>config/database.php</code>里。<br>如果使用<code>mysql</code>，为了以后能使用<code>emoji</code>表情，建议修改<code>charset</code>为<code>utf8mb4</code>，相应的<code>collation</code>也要修改为<code>utf8mb4_unicode_ci</code></p>
<p>修改<code>.env</code>文件，添加自己的数据库连接配置（之后请确保数据库能连接上）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DB_HOST=</div><div class="line">DB_DATABASE=</div><div class="line">DB_USERNAME=</div><div class="line">DB_PASSWORD=</div></pre></td></tr></table></figure>
<p>数据库建表文件，存放在<code>database/migrations/</code>目录下；框架已自带了登录授权相关的2个表文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">database/migrations/2014_10_12_000000_create_users_table.php</div><div class="line">database/migrations/2014_10_12_100000_create_password_resets_table.php</div></pre></td></tr></table></figure>
<p>如果没有特别需求（如自带的表文件是使用<code>email</code>登录，如果需要使用<code>username</code>的方式，请自行修改，这里不再详述），我们直接拿来用即可。</p>
<p>首先我们先自己去新建一个数据库（建议<code>charset</code>为<code>utf8mb4</code>，<code>collation</code>为<code>utf8mb4_unicode_ci</code>），注意名字要跟上面的<code>DB_DATABASE</code>一样；</p>
<p>然后在项目根目录执行以下命令即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan migrate</div></pre></td></tr></table></figure>
<p>建议先完整看一下官方文档，了解数据库相关操作：<br><a href="http://laravelacademy.org/post/2942.html" target="_blank" rel="external">数据库</a><br><a href="http://laravelacademy.org/post/2995.html" target="_blank" rel="external">Eloquent ORM</a></p>
<h1 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h1><h2 id="auth流程分析"><a href="#auth流程分析" class="headerlink" title="auth流程分析"></a>auth流程分析</h2><p>我们先来看看<code>auth</code>登录授权的相关流程：</p>
<p>当我们访问<code>www.your-domain.com/home</code>时，会有这样的流程：</p>
<p>1、框架在<code>routes.php</code>里匹配到<code>Route::get(&#39;/home&#39;, &#39;HomeController@index&#39;);</code>这条路由。<br>接下来进入<code>app/Http/Controllers/HomeController.php</code>这个文件。</p>
<p>2、<code>HomeController.php</code>的构造函数里，有中间件<code>auth</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public function __construct()</div><div class="line">&#123;</div><div class="line">    $this-&gt;middleware(&apos;auth&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么<code>auth</code>中间件将会去访问<code>app/Http/Middleware/Authenticate.php</code> 里的 <code>handle</code> 函数</p>
<p>3、<code>app/Http/Middleware/Authenticate.php</code>里<code>handle</code>函数有这样一句代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">redirect()-&gt;guest(&apos;login&apos;);</div></pre></td></tr></table></figure>
<p>则接下来会重定向至此url: <code>www.your-domain.com/login</code></p>
<p>4、重定向会重新去匹配路由。让我们执行一下命令，查看一下现在有什么路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan route:list</div></pre></td></tr></table></figure>
<p><img src="http://aevit.qiniudn.com/482167b8e90566dc8d63275c2106ad581462951315.jpeg" alt="image"></p>
<p>我们发现里面有<code>login</code>这条路由了。</p>
<p>在<code>routes.php</code>里<code>Route::auth()</code>有这一句代码。查看源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/vendor/laravel/framework/src/Illuminate/Routing/Router.php</div></pre></td></tr></table></figure>
<p>发现有<code>auth()</code>这一个函数，里面包含了<code>login</code>等路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public function auth()</div><div class="line">&#123;</div><div class="line">    // Authentication Routes...</div><div class="line">    $this-&gt;get(&apos;login&apos;, &apos;Auth\AuthController@showLoginForm&apos;);</div><div class="line">    $this-&gt;post(&apos;login&apos;, &apos;Auth\AuthController@login&apos;);</div><div class="line">    $this-&gt;get(&apos;logout&apos;, &apos;Auth\AuthController@logout&apos;);</div><div class="line"></div><div class="line">    // Registration Routes...</div><div class="line">    $this-&gt;get(&apos;register&apos;, &apos;Auth\AuthController@showRegistrationForm&apos;);</div><div class="line">    $this-&gt;post(&apos;register&apos;, &apos;Auth\AuthController@register&apos;);</div><div class="line"></div><div class="line">    // Password Reset Routes...</div><div class="line">    $this-&gt;get(&apos;password/reset/&#123;token?&#125;&apos;, &apos;Auth\PasswordController@showResetForm&apos;);</div><div class="line">    $this-&gt;post(&apos;password/email&apos;, &apos;Auth\PasswordController@sendResetLinkEmail&apos;);</div><div class="line">    $this-&gt;post(&apos;password/reset&apos;, &apos;Auth\PasswordController@reset&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以，访问<code>www.your-domain.com/login</code>就会匹配到<code>login</code>路由。<br>接下来根据这条路由，我们进入<code>Auth\AuthController</code>去看一下，该文件路径：<br>（顺便记住<code>showLoginForm</code>这个函数名字，下面会用到）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app/Http/Controllers/Auth/AuthController.php</div></pre></td></tr></table></figure>
<p>5、<code>Auth\AuthController.php</code>里我们发现没有<code>showLoginForm</code>这个函数，但是有这一句代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">use AuthenticatesAndRegistersUsers, ThrottlesLogins;</div></pre></td></tr></table></figure>
<p>让我们查看<code>AuthenticatesAndRegistersUsers</code>这个文件，查看源码，发现这个文件在这个路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vendor/laravel/framework/src/Illuminate/Foundation/Auth/AuthenticatesAndRegistersUsers.php</div></pre></td></tr></table></figure>
<p>里面又有这样一句代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">use AuthenticatesUsers, RegistersUsers</div></pre></td></tr></table></figure>
<p>让我们再次查看<code>AuthenticatesUsers</code>这个文件，这个文件在这个路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vendor/laravel/framework/src/Illuminate/Foundation/Auth/AuthenticatesUsers.php</div></pre></td></tr></table></figure>
<p>6、<code>AuthenticatesUsers.php</code>这里面我们发现有<code>showLoginForm</code>这个函数了，源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public function showLoginForm()</div><div class="line">&#123;</div><div class="line">    $view = property_exists($this, &apos;loginView&apos;)</div><div class="line">                ? $this-&gt;loginView : &apos;auth.authenticate&apos;;</div><div class="line"></div><div class="line">    if (view()-&gt;exists($view)) &#123;</div><div class="line">        return view($view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return view(&apos;auth.login&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里会判断如果没有<code>loginView</code>这个属性，就自动跳转至<code>auth.login</code>这个模版文件，所以这个<code>loginView</code>是可以让我们来自定义登录页面路径的一个属性。</p>
<p>7、接下来就会访问<code>auth.login</code>这个模版文件，就会去找到该文件渲染页面了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resources/views/auth/login.blade.php</div></pre></td></tr></table></figure>
<p>以上就是整个登录授权的基本流程了。</p>
<h2 id="新文件说明"><a href="#新文件说明" class="headerlink" title="新文件说明"></a>新文件说明</h2><p>接下来对刚才执行<code>artisan</code>命令后的变动的文件进行简单的说明</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>新增加的一个路由配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([&apos;middleware&apos; =&gt; &apos;web&apos;], function () &#123;</div><div class="line">    Route::auth();</div><div class="line"></div><div class="line">    Route::get(&apos;/home&apos;, &apos;HomeController@index&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>Laravel</code>自带了两个中间件<code>web</code>和<code>api</code>，其中<code>web</code>使用<code>session</code>，<code>api</code>使用<code>token</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">protected $middlewareGroups = [</div><div class="line">  &apos;web&apos; =&gt; [</div><div class="line">        \App\Http\Middleware\EncryptCookies::class,</div><div class="line">        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,</div><div class="line">        \Illuminate\Session\Middleware\StartSession::class,</div><div class="line">        \Illuminate\View\Middleware\ShareErrorsFromSession::class,</div><div class="line">        \App\Http\Middleware\VerifyCsrfToken::class,</div><div class="line">    ],</div><div class="line"></div><div class="line">    &apos;api&apos; =&gt; [</div><div class="line">        &apos;throttle:60,1&apos;,</div><div class="line">        &apos;auth:api&apos;,</div><div class="line">    ],</div><div class="line">];</div></pre></td></tr></table></figure>
<p>这里统一使用了<code>web</code>中间件。</p>
<h3 id="HomeController"><a href="#HomeController" class="headerlink" title="HomeController"></a>HomeController</h3><p>我们查看<code>app/Http/Controllers/HomeController.php</code>文件，会发现在构造函数里有一个中间件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public function __construct()</div><div class="line">&#123;</div><div class="line">    $this-&gt;middleware(&apos;auth&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个<code>auth</code>中间件就是判断访问该<code>controller</code>的页面是否需要登录验证的一个东西。<br>如访问<code>www.your-domain.com/home</code>就会自动判断如果没有登录，就自动跳转至登录页面<code>www.your-domain.com/login</code></p>
<h3 id="blade模版文件"><a href="#blade模版文件" class="headerlink" title="blade模版文件"></a>blade模版文件</h3><p>注意<code>resources/views/auth/login.blade.php</code>代码里有用到<code>$error</code>这个<code>stdClass</code>，这个<code>$error</code>是在<code>web</code>中间件里定义的，所以如果<code>auth路由组</code>没有使用<code>web</code>中间件，就会报错了。所以要把<code>Route::auth();</code>这句写在路由组里。</p>
<p>当然，如果你完全使用的是<strong>自定义</strong>的登录注册相关<code>blade</code>文件，就可以忽略了，根据自己需求去写就行了。</p>
<h1 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h1><h2 id="修改auth前缀"><a href="#修改auth前缀" class="headerlink" title="修改auth前缀"></a>修改auth前缀</h2><p>更改<code>auth</code>相关路由的前缀，如<code>www.your-domain.com/admin/login</code>；</p>
<p>通过上面<code>auth流程分析</code>的说明，我们可以只需做以下操作即可增加前缀：</p>
<p>1、修改<code>routes.php</code>，加上<code>prefix</code>参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([&apos;prefix&apos; =&gt; &apos;admin&apos;, &apos;middleware&apos; =&gt; &apos;web&apos;], function () &#123;</div><div class="line">    Route::auth();</div><div class="line"></div><div class="line">    Route::get(&apos;/home&apos;, &apos;HomeController@index&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>2、修改<code>app/Http/Middleware/Authenticate.php</code>，将<code>redirect()-&gt;guest(&#39;login&#39;);</code>改为以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">redirect()-&gt;guest(&apos;admin/login&apos;);</div></pre></td></tr></table></figure>
<h2 id="转移blade文件路径"><a href="#转移blade文件路径" class="headerlink" title="转移blade文件路径"></a>转移blade文件路径</h2><p>有时需要将<code>auth</code>相关的<code>blade</code>模版文件转移路径。<br>比如说原本是在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resources/views/auth/login.blade.php</div></pre></td></tr></table></figure>
<p>现在要转移至</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resources/views/admin/auth/login.blade.php</div></pre></td></tr></table></figure>
<p>通过上面的流程分析，我们只需要在<code>app/Http/Controllers/Auth/AuthController.php</code>文件，增加属性<code>$loginView</code>来设置<code>blade</code>模版文件路径即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 设置登录页面的模版文件：  </div><div class="line">protected $loginView = &apos;admin.auth.login&apos;;</div></pre></td></tr></table></figure>
<p>网上说是修改<code>$loginPath</code>，经过排查，发现<code>5.2版本</code>后，跟以前的不一样了，以前的才是<code>$loginPath</code>，现在要<code>$loginView</code>。</p>
<p>可查看以下<code>5.1</code>及<code>5.2</code>的<code>authentication</code>官方文档，在<code>5.1</code>的文档里搜索<code>loginPath</code>会有结果，而<code>5.2</code>已经没了：</p>
<p><a href="https://laravel.com/docs/5.1/authentication" target="_blank" rel="external">5.1文档 - authentication</a><br><a href="https://laravel.com/docs/5.2/authentication" target="_blank" rel="external">5.2文档 - authentication</a></p>
<p>如果还需要修改登录页面的其他属性，可去查看源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vendor/laravel/framework/src/Illuminate/Foundation/Auth/AuthenticatesUsers.php</div></pre></td></tr></table></figure>
<p>如果需要查看<strong>注册页面</strong>的相关属性，可查看源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vendor/laravel/framework/src/Illuminate/Foundation/Auth/RegistersUsers.php</div></pre></td></tr></table></figure>
<p>可以发现还可以自定义这些路径，只要在<code>AuthController.php</code>里添加以下属性即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 设置退出登录后的路径：  </div><div class="line">protected $redirectAfterLogout = &apos;admin/login&apos;;</div><div class="line"></div><div class="line">// 设置注册页面的模版文件：</div><div class="line">protected $registerView = &apos;admin.auth.register&apos;;</div></pre></td></tr></table></figure>
<hr>
<p>2016.05.11 21:47<br>Aevit<br>华师</p>
<p><a href="http://aevit.qiniudn.com/moon-from-650d.jpg" title="楼顶月" target="_blank" rel="external"><img src="http://aevit.qiniudn.com/moon-from-650d.jpg" alt=""></a><br>摄影：Aevit 2015年 32楼顶</p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/比特海/">比特海</a>
            
              <a href="/tags/PHP/">PHP</a>
            
              <a href="/tags/Laravel/">Laravel</a>
            
              <a href="/tags/登录授权/">登录授权</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/05/23/sketch-study-3-marathon/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">sketch设计学习（三）—— 马拉松</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2016/05/07/css-center/">
        <span class="next-text nav-default">CSS居中</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:aevit@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/aevit" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2014 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Aevit</span>
  </span>
  <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://aevit.xyz/2016/05/11/laravel-learning-2/';
        this.page.identifier = '2016/05/11/laravel-learning-2/';
        this.page.title = 'Laravel学习笔记（二）- 登录授权流程分析';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//aevit.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.5.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.5.0"></script>
  </body>
</html>
